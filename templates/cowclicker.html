{% extends '_base.html' %}
{% block header %}
WELCOME TO COW CLICKER
{% endblock %}

{% block nav %}
<nav>
	<a href="store.html" target="_self" class="NavLink">Cow Store</a>
	<a href="cowclicker.html" target="_self" class="NavLink">The Pasture</a>
</nav>
{% endblock %}


{% block content %}

<div>
  Click the cow for points.
</div>

<!-- Make the data we actually pull from off the page display: none; -->
<div id="POINTS">You have <span id="points">{{ init_points }}</span> points.</div>
<div id="COWS">The state of your cows is <span id="cows">{{ init_cows }}</span>.</div>

<script>
	// var points = 0;  store in HTML element and read onload
	var debounce = false; // defeat race condition

	document.getElementById('points').onload = function() {
		points = document.getElementById('points').innerHTML;
		cows = document.getElementById('cows').innerHTML;
		console.log("Loaded " + points + " points. Thanks for returning!");
		console.log("Loaded " + cows + " as the state of your cows. Thanks for returning!");
		debounce = true;
	};
	
	function clickThatCow(imageElement) {
		if (debounce) {
		  var inc;

		  // change the score incrementer based on which cow is clicked
		  switch(imageElement.src){
			case "/static/standardCow.jpeg":
			  inc = 100;
			  break;

			case "/static/cuteCow.jpg":
			  inc = 175;
			  break;

			case "/static/sillyCow.jpg":
			  inc = Math.floor(Math.random()*500) + 1; // this will get a number between 1 and 500;
			  inc *= Math.floor(Math.random()*2) == 1 ? 1 : -1; // this will add minus sign in 50% of cases
			  break;

			case "/static/chonkCow.jpg":
			  inc = Math.floor(Math.random()*5) == 2 ? 600 : 300; // 20% chance of inc = 600, 80% chance inc = 300
			  break;
			
			case "/static/minecraftCow.jpg":
			  temp = Math.floor(Math.random()*10) + 1; // 10% chance of any power of 2 from 0 - 10
			  inc = Math.pow(2, temp);
			  break;
		  }
		  points += inc;
		  
		  // This retrieves the "div" element with id "Points"
		  var pointsSpan = document.getElementById('points');
		  pointsSpan.innerHTML = points;

		  console.log("You now have " + points + " points!");
		}
	}

  // If the user's "cows" data says they own a certain cow, then set the
  // images src to the correct cow image source. If the user does not own 
  // a certain cow then that image's source will be set to Tall Grass
  if(cows & 2 == 2){
    document.getElementById("cow1").src="static/cuteCow.jpg";
  }else{
    document.getElementById("cow1").src="static/tallGrass.jpg";
  }

  if(cows & 4 == 4){
    document.getElementById("cow2").src="static/sillyCow.jpg";
  }else{
    document.getElementById("cow2").src="static/tallGrass.jpg";
  }

  if(cows & 8 == 8){
    document.getElementById("cow3").src="static/chonkCow.jpg";
  }else{
    document.getElementById("cow3").src="static/tallGrass.jpg";
  }

  if(cows & 16 == 16){
    document.getElementById("cow4").src="static/minecraftCow.jpg";
  }else{
    document.getElementById("cow4").src="static/tallGrass.jpg";
  } // make sure this runs after stuff loads???
</script>
<div>
<img id="cow0" src="static/cuteCow.jpg" style="width:500px;height:600px;" onclick="clickThatCow(this);">
<img id="cow1" src="static/sillyCow.jpg" style="width:500px;height:600px;" onclick="clickThatCow(this);">
<img id="cow2" src="static/chonkCow.jpg" style="width:500px;height:600px;" onclick="clickThatCow(this);">
<img id="cow3" src="static/minecraftCow.jpg" style="width:500px;height:600px;" onclick="clickThatCow(this);">
<img id="cow4" style="width:500px;height:600px;" onclick="clickThatCow(this);">
</div>

{% endblock %}