{% extends '_base.html' %}
{% block header %}
WELCOME TO COW CLICKER
{% endblock %}

{% block nav %}
<nav>
	<a href="store.html" target="_self" class="NavLink">Cow Store</a>
	<a href="cowclicker.html" target="_self" class="NavLink">The Pasture</a>
</nav>
{% endblock %}

{% block content %}

<div>
  Click the cow for points.
</div>

<!-- Make the data we actually pull from off the page display: none; -->
<div onload="loadGameState()">
	<div id="POINTz">You have <span id="points">{{ init_points }}</span> points.</div>
	<div id="COWz">The state of your cows is <span id="cows">{{ init_cows }}</span>.</div>
</div>

<div id="thePasture">
	<img class="clickableCow" id="cow0" src="static/standardCow.jpeg" onclick="clickThatCow(0);">
	<img class="clickableCow" id="cow1" src="static/tallGrass.jpg" onclick="clickThatCow(1);">
	<img class="clickableCow" id="cow2" src="static/tallGrass.jpg" onclick="clickThatCow(2);">
	<img class="clickableCow" id="cow3" src="static/tallGrass.jpg" onclick="clickThatCow(3);">
	<img class="clickableCow" id="cow4" src="static/tallGrass.jpg" onclick="clickThatCow(4);">
	<!--
	<img class="clickableCow" id="cow0" src="static/cuteCow.jpg" onclick="clickThatCow(1);">
	<img class="clickableCow" id="cow1" src="static/sillyCow.jpg" onclick="clickThatCow(2);">
	<img class="clickableCow" id="cow2" src="static/chonkCow.jpg" onclick="clickThatCow(3);">
	<img class="clickableCow" id="cow3" src="static/minecraftCow.jpg" onclick="clickThatCow(4);">
	<img class="clickableCow" id="cow4" src="static/standardCow.jpeg" onclick="clickThatCow(0);">
	-->
</div>

<script>
	// var points = 0;  store in HTML element and read onload
	var debounce = false; // race condition might not be so detrimental

	function loadGameState() {
		points = document.getElementById('points').innerHTML;
		cows = document.getElementById('cows').innerHTML;
		console.log("Loaded " + points + " points. Thanks for returning!");
		console.log("Loaded " + cows + " as the state of your cows. Thanks for returning!");
		debounce = true;
	};
	
	isStart = true;
	function clickThatCow(cowID) {
		if (isStart) {
			isStart = false
			loadGameState() // onload does not work...
			loadUnlockedCows()
		}
		console.log("Outside debounce");
	//  if (debounce) {
		  var inc = 0;
		  console.log("Entering switch");

		  // change the score incrementer based on which cow is clicked
		  switch(cowID){
			  case 0:
			//case "https://cow-clicker-2.appspot.com/static/standardCow.jpeg":
			  inc = 100;
			  break;
	
			  case 1:
			//case "https://cow-clicker-2.appspot.com/static/cuteCow.jpg":
			  inc = 175;
			  break;

			  case 2:
			//case "https://cow-clicker-2.appspot.com/static/sillyCow.jpg":
			  inc = Math.floor(Math.random()*500) + 1; // this will get a number between 1 and 500;
			  inc *= Math.floor(Math.random()*2) == 1 ? 1 : -1; // this will add minus sign in 50% of cases
			  break;
				  
			  case 3:
			//case "https://cow-clicker-2.appspot.com/static/chonkCow.jpg":
			  inc = Math.floor(Math.random()*5) == 2 ? 600 : 300; // 20% chance of inc = 600, 80% chance inc = 300
			  break;
			
			  case 4:
			//case "https://cow-clicker-2.appspot.com/static/minecraftCow.jpg":
			  temp = Math.floor(Math.random()*10) + 1; // 10% chance of any power of 2 from 0 - 10
			  inc = Math.pow(2, temp);
			  break;

			default:
				console.log("Default case ran!")
				inc = 100;
				break;
		  }
		  points = Number(points)
		  points += inc; // JS is dumb

		  document.getElementById('points').innerHTML = points;
		  console.log("You now have " + points + " points!");
	//	}
	}


	// run once all the cows have loaded
	document.getElementById("thePasture").onload = function() {
		loadUnlockedCows() // on load has proven to be finnicky, so this also happens in first click
	}

	// Run on first click
	function loadUnlockedCows() {
		// If the user's "cows" data says they own a certain cow, then set the
		// images src to the correct cow image source. If the user does not own 
		// a certain cow then that image's source will be set to Tall Grass

		console.log("Cow state is apparently " + cows);


		if ((Number(cows) & 2) == 2){
			document.getElementById("cow1").src="static/cuteCow.jpg";
		}else{
			document.getElementById("cow1").src="static/tallGrass.jpg";
		}
		
		if ((Number(cows) & 4) == 4){
			document.getElementById("cow2").src="static/sillyCow.jpg";
		}else{
			document.getElementById("cow2").src="static/tallGrass.jpg";
		}
		
		if ((Number(cows) & 8) == 8){
			document.getElementById("cow3").src="static/chonkCow.jpg";
		}else{
			document.getElementById("cow3").src="static/tallGrass.jpg";
		}
		
		if ((Number(cows) & 16) == 16){
			document.getElementById("cow4").src="static/minecraftCow.jpg";
		}else{
			document.getElementById("cow4").src="static/tallGrass.jpg";
		}
	}
</script>

{% endblock %}
